<!-- =========================
TPV TIENDA ‚Äî B/W PRO (OPCI√ìN 1 / GITHUB) ‚Äî PAQUETE PRO
Archivo: index.html
- UI PRO + POS split
- Barcode global listener (en app.js)
- Categor√≠as: crear/renombrar/asignar
- Importe r√°pido: teclado num√©rico en pantalla
- Tickets aparcados m√∫ltiples
- PrintArea 80mm
========================= -->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b3d2e" />
  <title>TPV TIENDA ‚Äî B/W PRO</title>

  <!-- IMPORTANTE: ./ para evitar rutas raras en GitHub Pages -->
  <link rel="stylesheet" href="./styles.css?v=1.2" />
</head>

<body class="theme-day">
  <div class="app" id="app">

    <!-- ===== TOP BAR ===== -->
    <header class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true">TPV</div>
        <div class="brand-text">
          <div class="brand-title">TPV TIENDA</div>
          <div class="brand-sub">B/W PRO ¬∑ IVA incluido</div>
        </div>
      </div>

      <nav class="tabs" role="tablist" aria-label="Secciones">
        <button class="tab is-active" role="tab" aria-selected="true" data-tab="venta">Venta</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="productos">Productos</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="ventas">Ventas / Reportes</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="beneficios">Beneficios</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="ajustes">
          Ajustes <span class="pill">Admin</span>
        </button>
      </nav>

      <div class="actions">
        <button class="btn btn-ghost" id="btnTheme" type="button" title="Cambiar modo d√≠a/noche">
          <span class="dot" aria-hidden="true"></span>
          <span id="themeLabel">D√≠a</span>
        </button>

        <button class="btn btn-ghost" id="btnLogin" type="button" title="Cambiar usuario">
          <span class="icon" aria-hidden="true">üë§</span>
          <span id="userLabel">CAJERO</span>
        </button>

        <button class="btn btn-admin" id="btnAdmin" type="button" title="Acceso Admin (PIN)">
          <span class="icon" aria-hidden="true">üîí</span>
          <span id="adminState">Admin</span>
        </button>
      </div>
    </header>

    <!-- ===== MAIN ===== -->
    <main class="main">

      <!-- =========================
           TAB: VENTA (DEFAULT)
      ========================== -->
      <section class="page is-active" data-page="venta">
        <div class="pos-grid">

          <!-- ===== LEFT ===== -->
          <section class="panel panel-left">
            <div class="panel-head">
              <div class="panel-title">
                <h2>Venta r√°pida</h2>
                <p>Esc√°ner ¬∑ categor√≠as ¬∑ favoritos</p>
              </div>

              <div class="panel-tools">
                <button class="btn btn-soft" id="btnQuickAmount" type="button">+ Importe</button>

                <button class="btn btn-soft" id="btnPark" type="button" title="Aparcar / Ver aparcados">
                  Aparcar <span class="badge badge-mini" id="parkBadge" hidden>0</span>
                </button>

                <button class="btn btn-ghost" id="btnCats" type="button" title="Gestionar categor√≠as">
                  Categor√≠as
                </button>
              </div>
            </div>

            <div class="card">
              <div class="field-row">
                <label class="field">
                  <span>Barcode (opcional, manual)</span>
                  <input id="barcodeInput" inputmode="numeric" autocomplete="off" placeholder="Puedes escanear aqu√≠, pero NO hace falta (modo global)" />
                  <small>Modo PRO: el sistema detecta escaneo global autom√°ticamente.</small>
                </label>

                <label class="field">
                  <span>Buscar producto</span>
                  <input id="searchInput" autocomplete="off" placeholder="Nombre o barcode‚Ä¶" />
                  <small>Filtra el grid de productos.</small>
                </label>
              </div>

              <!-- Chips din√°micos -->
              <div class="chips" id="catChips"></div>
            </div>

            <div class="section-title">
              <span>Productos</span>
              <div class="section-actions">
                <button class="btn btn-ghost" id="btnAddProductInline" type="button" title="Alta r√°pida (barcode primero)">
                  + Producto
                </button>
              </div>
            </div>

            <div class="fav-grid" id="favGrid" aria-label="Productos r√°pidos"></div>

            <div class="hint">
              <div class="hint-title">Atajos</div>
              <div class="hint-body">
                <span class="kbd">F4</span> Cobrar ¬∑
                <span class="kbd">F2</span> Importe r√°pido ¬∑
                <span class="kbd">Supr</span> Borrar √∫ltima ¬∑
                <span class="kbd">Esc</span> Limpiar/Salir ¬∑
                <span class="kbd">+</span>/<span class="kbd">-</span> Qty √∫ltima
              </div>
            </div>
          </section>

          <!-- ===== RIGHT ===== -->
          <section class="panel panel-right">
            <div class="panel-head">
              <div class="panel-title">
                <h2>Ticket</h2>
                <p><span class="mono" id="ticketNo">T-000001</span> ¬∑ <span id="ticketDate">‚Äî</span></p>
              </div>

              <div class="panel-tools">
                <button class="btn btn-ghost" id="btnLastTicket" type="button" title="Reimprimir √∫ltimo ticket">√öltimo</button>
                <button class="btn btn-ghost" id="btnEmailTicket" type="button" title="Enviar ticket por email">Email</button>
                <button class="btn btn-ghost" id="btnPrint" type="button" title="Imprimir ticket (80mm)">Imprimir</button>
              </div>
            </div>

            <div class="ticket card">
              <div class="ticket-head">
                <div class="ticket-shop">
                  <div class="ticket-shop-name" id="shopName">Tu Tienda</div>
                  <div class="ticket-shop-sub" id="shopSub">CIF / Direcci√≥n / Tel</div>
                </div>
                <div class="ticket-meta">
                  <div><span class="muted">Caja:</span> <span class="mono" id="posBox">CAJA-1</span></div>
                  <div><span class="muted">Cajero:</span> <span class="mono" id="posUser">CAJERO</span></div>
                </div>
              </div>

              <div class="ticket-lines" id="ticketLines" role="table" aria-label="L√≠neas del ticket">
                <div class="trow thead" role="row">
                  <div class="tcell">Producto</div>
                  <div class="tcell tcell-center">Qty</div>
                  <div class="tcell tcell-right">PVP</div>
                  <div class="tcell tcell-right">Total</div>
                </div>
              </div>

              <div class="ticket-totals">
                <div class="totals-grid">
                  <div class="total-row">
                    <span class="muted">L√≠neas</span>
                    <span class="mono" id="linesCount">0</span>
                  </div>
                  <div class="total-row">
                    <span class="muted">Subtotal</span>
                    <span class="mono" id="subTotal">0,00 ‚Ç¨</span>
                  </div>
                  <div class="total-row">
                    <span class="muted">IVA</span>
                    <span class="mono">Incluido</span>
                  </div>
                  <div class="total-row total-strong">
                    <span>Total</span>
                    <span class="mono" id="grandTotal">0,00 ‚Ç¨</span>
                  </div>
                </div>

                <div class="pay-grid">
                  <div class="pay-tabs" role="tablist" aria-label="M√©todo de pago">
                    <button class="pay-tab is-active" type="button" data-pay="efectivo">Efectivo</button>
                    <button class="pay-tab" type="button" data-pay="tarjeta">Tarjeta</button>
                    <button class="pay-tab" type="button" data-pay="mixto">Mixto</button>
                  </div>

                  <div class="pay-fields">
                    <label class="field">
                      <span>Entregado</span>
                      <input id="givenInput" inputmode="decimal" placeholder="0,00" />
                    </label>
                    <label class="field">
                      <span>Cambio</span>
                      <input id="changeInput" inputmode="decimal" placeholder="0,00" disabled />
                    </label>
                    <label class="field">
                      <span>Nombre / nota (opcional)</span>
                      <input id="noteName" placeholder="Ej: Mesa 2 / Cliente / Nota‚Ä¶" />
                    </label>
                  </div>
                </div>

                <div class="cta-row">
                  <button class="btn btn-danger" id="btnVoid" type="button">Anular</button>
                  <button class="btn btn-soft" id="btnRefund" type="button" title="Requiere PIN admin">Devoluci√≥n</button>
                  <button class="btn btn-primary" id="btnPay" type="button">Cobrar</button>
                </div>

                <div class="mini-note muted">Ticket 80mm ¬∑ IVA incluido ¬∑ Escaneo global siempre activo</div>
              </div>
            </div>

          </section>
        </div>
      </section>

      <!-- =========================
           TAB: PRODUCTOS
      ========================== -->
      <section class="page" data-page="productos">
        <div class="page-wrap">
          <div class="page-head">
            <div>
              <h2>Productos</h2>
              <p>Alta, edici√≥n, favoritos, import/export CSV.</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-soft" id="btnCats2" type="button">Categor√≠as</button>
              <button class="btn btn-soft" id="btnImportCsv" type="button">Importar CSV</button>
              <button class="btn btn-soft" id="btnExportCsv" type="button">Exportar CSV</button>
              <button class="btn btn-primary" id="btnAddProduct" type="button">+ Nuevo producto</button>
            </div>
          </div>

          <div class="card">
            <div class="field-row">
              <label class="field">
                <span>Buscar por nombre</span>
                <input id="prodSearchName" placeholder="Ej: manzana‚Ä¶" />
              </label>
              <label class="field">
                <span>Buscar por barcode</span>
                <input id="prodSearchBarcode" inputmode="numeric" placeholder="Escanear / escribir barcode‚Ä¶" />
              </label>
              <label class="field">
                <span>Categor√≠a</span>
                <select id="prodSearchCat"></select>
              </label>
            </div>
          </div>

          <div class="table card" id="productsTable">
            <div class="trow thead">
              <div class="tcell">Producto</div>
              <div class="tcell">Barcode</div>
              <div class="tcell tcell-right">PVP (IVA incl.)</div>
              <div class="tcell tcell-right">Compra (opc.)</div>
              <div class="tcell tcell-center">Fav</div>
              <div class="tcell tcell-right">Acciones</div>
            </div>
          </div>

          <div class="hint">
            <div class="hint-title">CSV</div>
            <div class="hint-body">
              Columnas: <span class="mono">barcode,name,price,cost,category,fav,unit</span>
            </div>
          </div>
        </div>
      </section>

      <!-- =========================
           TAB: VENTAS / REPORTES
      ========================== -->
      <section class="page" data-page="ventas">
        <div class="page-wrap">
          <div class="page-head">
            <div>
              <h2>Ventas / Reportes</h2>
              <p>Historial, reimpresi√≥n y Cierre Z (arqueo).</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-soft" id="btnCloseZ" type="button">Cierre Z</button>
              <button class="btn btn-soft" id="btnExportSalesJson" type="button">Exportar JSON</button>
              <button class="btn btn-soft" id="btnImportSalesJson" type="button">Importar JSON</button>
            </div>
          </div>

          <div class="grid-2">
            <div class="card">
              <h3>Resumen</h3>
              <div class="stat-grid">
                <div class="stat">
                  <div class="stat-label">Tickets</div>
                  <div class="stat-value mono" id="statTickets">0</div>
                </div>
                <div class="stat">
                  <div class="stat-label">Total</div>
                  <div class="stat-value mono" id="statTotal">0,00 ‚Ç¨</div>
                </div>
                <div class="stat">
                  <div class="stat-label">Efectivo</div>
                  <div class="stat-value mono" id="statCash">0,00 ‚Ç¨</div>
                </div>
                <div class="stat">
                  <div class="stat-label">Tarjeta</div>
                  <div class="stat-value mono" id="statCard">0,00 ‚Ç¨</div>
                </div>
              </div>
            </div>

            <div class="card">
              <h3>Cierres Z</h3>
              <div class="chart-placeholder" id="closingsBox">
                <div class="muted">Sin cierres todav√≠a.</div>
              </div>
            </div>
          </div>

          <div class="table card" id="salesTable">
            <div class="trow thead">
              <div class="tcell">Fecha</div>
              <div class="tcell">Ticket</div>
              <div class="tcell">Pago</div>
              <div class="tcell tcell-right">Total</div>
              <div class="tcell tcell-right">Acciones</div>
            </div>
          </div>
        </div>
      </section>

      <!-- =========================
           TAB: BENEFICIOS
      ========================== -->
      <section class="page" data-page="beneficios">
        <div class="page-wrap">
          <div class="page-head">
            <div>
              <h2>Beneficios</h2>
              <p>Calculado si hay precio compra (opcional).</p>
            </div>
          </div>

          <div class="grid-2">
            <div class="card">
              <h3>Beneficio bruto</h3>
              <div class="stat-grid">
                <div class="stat">
                  <div class="stat-label">Ventas</div>
                  <div class="stat-value mono" id="profitSales">0,00 ‚Ç¨</div>
                </div>
                <div class="stat">
                  <div class="stat-label">Coste</div>
                  <div class="stat-value mono" id="profitCost">0,00 ‚Ç¨</div>
                </div>
                <div class="stat">
                  <div class="stat-label">Beneficio</div>
                  <div class="stat-value mono" id="profitValue">0,00 ‚Ç¨</div>
                </div>
                <div class="stat">
                  <div class="stat-label">Margen</div>
                  <div class="stat-value mono" id="profitMargin">0,0 %</div>
                </div>
              </div>
            </div>

            <div class="card">
              <h3>Nota</h3>
              <div class="chart-placeholder">
                <div class="muted">Parte PRO: ya calcula beneficio y margen por ventas guardadas.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- =========================
           TAB: AJUSTES (ADMIN)
      ========================== -->
      <section class="page" data-page="ajustes">
        <div class="page-wrap">
          <div class="page-head">
            <div>
              <h2>Ajustes</h2>
              <p>PIN Admin local ¬∑ backups ¬∑ velocidad caja.</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-admin" id="btnAdminUnlock" type="button">Desbloquear Admin</button>
            </div>
          </div>

          <div class="grid-2">
            <div class="card">
              <h3>Datos de tienda</h3>
              <div class="field-row">
                <label class="field">
                  <span>Nombre tienda</span>
                  <input id="setShopName" value="Tu Tienda" />
                </label>
                <label class="field">
                  <span>Subt√≠tulo (CIF / direcci√≥n)</span>
                  <input id="setShopSub" value="CIF / Direcci√≥n / Tel" />
                </label>
              </div>
              <div class="field-row">
                <label class="field">
                  <span>Caja</span>
                  <input id="setBoxName" value="CAJA-1" />
                </label>
                <label class="field">
                  <span>Pie de ticket</span>
                  <input id="setFooterText" value="Gracias por su compra" />
                </label>
              </div>
            </div>

            <div class="card">
              <h3>Velocidad</h3>
              <div class="field-row">
                <label class="field">
                  <span>Cobro directo (sin modal)</span>
                  <select id="setDirectPay">
                    <option value="0" selected>No</option>
                    <option value="1">S√≠</option>
                  </select>
                </label>
                <label class="field">
                  <span>Auto-imprimir tras cobrar</span>
                  <select id="setAutoPrint">
                    <option value="0" selected>No</option>
                    <option value="1">S√≠</option>
                  </select>
                </label>
              </div>

              <div class="field-row">
                <label class="field">
                  <span>Auto-cambiar a ‚ÄúVenta‚Äù al escanear</span>
                  <select id="setAutoGoSale">
                    <option value="1" selected>S√≠</option>
                    <option value="0">No</option>
                  </select>
                </label>
                <label class="field">
                  <span>Beep al escanear</span>
                  <select id="setBeep">
                    <option value="1" selected>S√≠</option>
                    <option value="0">No</option>
                  </select>
                </label>
              </div>

              <div class="muted small">Escaneo global siempre activo: detecta teclado/lector y a√±ade al instante.</div>
            </div>
          </div>

          <div class="card">
            <h3>Seguridad</h3>
            <div class="field-row">
              <label class="field">
                <span>PIN Admin (c√°mbialo)</span>
                <input id="setAdminPin" type="password" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                <small>Por defecto: 1234 (c√°mbialo aqu√≠).</small>
              </label>
              <label class="field">
                <span>Backup</span>
                <div class="row-btns">
                  <button class="btn btn-soft" id="btnExportJson" type="button">Exportar JSON</button>
                  <button class="btn btn-soft" id="btnImportJson" type="button">Importar JSON</button>
                </div>
              </label>
            </div>

            <div class="hint">
              <div class="hint-title">Usuarios demo</div>
              <div class="hint-body">cajero/1234 ¬∑ admin/1234 ¬∑ PIN Admin: 1234</div>
            </div>
          </div>
        </div>
      </section>

    </main>

    <!-- ===== FOOTER ===== -->
    <footer class="footer">
      <div class="footer-left">
        <span class="badge badge-ok">Local</span>
        <span class="muted">GitHub Pages ¬∑ LocalStorage</span>
      </div>
      <div class="footer-right muted"><span class="mono" id="appVersion">v1.2 PRO</span></div>
    </footer>
  </div>

  <!-- PRINT AREA 80MM -->
  <div id="printArea" class="print-area" aria-hidden="true"></div>

  <!-- TOAST -->
  <div id="toastHost" class="toast-host" aria-hidden="true"></div>

  <!-- BACKDROP -->
  <div class="modal-backdrop" id="backdrop" hidden></div>

  <!-- LOGIN -->
  <dialog class="modal" id="modalLogin" aria-label="Login">
    <div class="modal-head">
      <div>
        <div class="modal-title">Login caja</div>
        <div class="muted small">Usuario + contrase√±a</div>
      </div>
      <button class="icon-btn" data-close="modalLogin" aria-label="Cerrar">‚úï</button>
    </div>
    <div class="modal-body">
      <label class="field">
        <span>Usuario</span>
        <input id="loginUser" autocomplete="username" placeholder="cajero" />
      </label>
      <label class="field">
        <span>Contrase√±a</span>
        <input id="loginPass" type="password" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        <small>Por defecto: cajero/1234 ¬∑ admin/1234</small>
      </label>
    </div>
    <div class="modal-foot">
      <button class="btn btn-ghost" data-close="modalLogin" type="button">Cancelar</button>
      <button class="btn btn-primary" id="btnLoginOk" type="button">Entrar</button>
    </div>
  </dialog>

  <!-- ADMIN PIN -->
  <dialog class="modal" id="modalAdmin" aria-label="PIN Admin">
    <div class="modal-head">
      <div>
        <div class="modal-title">PIN Admin</div>
        <div class="muted small">Acciones sensibles</div>
      </div>
      <button class="icon-btn" data-close="modalAdmin" aria-label="Cerrar">‚úï</button>
    </div>
    <div class="modal-body">
      <label class="field">
        <span>PIN</span>
        <input id="adminPin" type="password" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        <small>Por defecto: 1234</small>
      </label>
    </div>
    <div class="modal-foot">
      <button class="btn btn-ghost" data-close="modalAdmin" type="button">Cancelar</button>
      <button class="btn btn-admin" id="btnAdminOk" type="button">Desbloquear</button>
    </div>
  </dialog>

  <!-- COBRO -->
  <dialog class="modal" id="modalPay" aria-label="Cobro">
    <div class="modal-head">
      <div>
        <div class="modal-title">Cobrar</div>
        <div class="muted small">Confirmaci√≥n r√°pida</div>
      </div>
      <button class="icon-btn" data-close="modalPay" aria-label="Cerrar">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="pay-confirm">
        <div class="pay-big">
          <div class="muted">Total</div>
          <div class="pay-total mono" id="payTotal">0,00 ‚Ç¨</div>
        </div>

        <div class="field-row">
          <label class="field">
            <span>M√©todo</span>
            <select id="payMethod">
              <option value="efectivo">Efectivo</option>
              <option value="tarjeta">Tarjeta</option>
              <option value="mixto">Mixto</option>
            </select>
          </label>

          <label class="field" id="payGivenWrap">
            <span>Entregado</span>
            <input id="payGiven" inputmode="decimal" placeholder="0,00" />
          </label>

          <label class="field" id="payChangeWrap">
            <span>Cambio</span>
            <input id="payChange" disabled placeholder="0,00" />
          </label>
        </div>

        <div class="field-row" id="paySplitWrap" hidden>
          <label class="field">
            <span>Efectivo (mixto)</span>
            <input id="payCash" inputmode="decimal" placeholder="0,00" />
          </label>
          <label class="field">
            <span>Tarjeta (mixto)</span>
            <input id="payCard" inputmode="decimal" placeholder="0,00" />
          </label>
        </div>

        <label class="field">
          <span>Nombre / nota (opcional)</span>
          <input id="payNote" placeholder="Ej: mesa 2 / cliente‚Ä¶" />
        </label>
      </div>
    </div>

    <div class="modal-foot">
      <button class="btn btn-ghost" data-close="modalPay" type="button">Cancelar</button>
      <button class="btn btn-primary" id="btnPayOk" type="button">Confirmar venta</button>
    </div>
  </dialog>

  <!-- IMPORTE R√ÅPIDO (TECLADO NUM√âRICO) -->
  <dialog class="modal" id="modalQuick" aria-label="Importe r√°pido">
    <div class="modal-head">
      <div>
        <div class="modal-title">Importe r√°pido</div>
        <div class="muted small">A√±ade una l√≠nea manual al ticket</div>
      </div>
      <button class="icon-btn" data-close="modalQuick" aria-label="Cerrar">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="quick-grid">
        <div class="quick-left">
          <label class="field">
            <span>Importe (‚Ç¨)</span>
            <input id="quickAmount" inputmode="decimal" placeholder="0,00" />
            <small>Usa el teclado num√©rico o escribe.</small>
          </label>

          <label class="field">
            <span>Nombre (opcional)</span>
            <input id="quickName" placeholder="Ej: Bolsa, Servicio, Ajuste‚Ä¶" />
          </label>

          <div class="hint">
            <div class="hint-title">Atajo</div>
            <div class="hint-body"><span class="kbd">F2</span> abre Importe r√°pido</div>
          </div>
        </div>

        <div class="keypad" id="keypad">
          <button class="key" data-k="7" type="button">7</button>
          <button class="key" data-k="8" type="button">8</button>
          <button class="key" data-k="9" type="button">9</button>
          <button class="key key-alt" data-k="bk" type="button">‚å´</button>

          <button class="key" data-k="4" type="button">4</button>
          <button class="key" data-k="5" type="button">5</button>
          <button class="key" data-k="6" type="button">6</button>
          <button class="key key-alt" data-k="c" type="button">C</button>

          <button class="key" data-k="1" type="button">1</button>
          <button class="key" data-k="2" type="button">2</button>
          <button class="key" data-k="3" type="button">3</button>
          <button class="key key-alt" data-k="00" type="button">00</button>

          <button class="key key-wide" data-k="0" type="button">0</button>
          <button class="key" data-k="." type="button">,</button>
          <button class="key key-ok" data-k="ok" type="button">OK</button>
        </div>
      </div>
    </div>

    <div class="modal-foot">
      <button class="btn btn-ghost" data-close="modalQuick" type="button">Cancelar</button>
      <button class="btn btn-primary" id="btnQuickOk" type="button">A√±adir</button>
    </div>
  </dialog>

  <!-- APARCADOS (MULTI) -->
  <dialog class="modal" id="modalParked" aria-label="Tickets aparcados">
    <div class="modal-head">
      <div>
        <div class="modal-title">Aparcados</div>
        <div class="muted small">Guardar / recuperar tickets</div>
      </div>
      <button class="icon-btn" data-close="modalParked" aria-label="Cerrar">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="parked-list" id="parkedList"></div>
      <div class="muted small">Tip: puedes renombrar para ‚ÄúMesa 2‚Äù, ‚ÄúCliente‚Äù, etc.</div>
    </div>
    <div class="modal-foot">
      <button class="btn btn-ghost" data-close="modalParked" type="button">Cerrar</button>
      <button class="btn btn-primary" id="btnParkNow" type="button">Aparcar ticket actual</button>
    </div>
  </dialog>

  <!-- CATEGOR√çAS (PRO) -->
  <dialog class="modal" id="modalCats" aria-label="Categor√≠as">
    <div class="modal-head">
      <div>
        <div class="modal-title">Categor√≠as</div>
        <div class="muted small">Crear / renombrar / borrar</div>
      </div>
      <button class="icon-btn" data-close="modalCats" aria-label="Cerrar">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="cats-add">
        <label class="field">
          <span>Nueva categor√≠a</span>
          <input id="newCatName" placeholder="Ej: Pan, Bebidas, Eco‚Ä¶" />
        </label>
        <button class="btn btn-primary" id="btnAddCat" type="button">A√±adir</button>
      </div>

      <div class="cats-list" id="catsList"></div>

      <div class="hint">
        <div class="hint-title">Reglas</div>
        <div class="hint-body">‚ÄúOtros‚Äù siempre existe. Si borras una categor√≠a, los productos pasan a ‚ÄúOtros‚Äù.</div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn btn-ghost" data-close="modalCats" type="button">Cerrar</button>
    </div>
  </dialog>

  <!-- ALTA / EDIT PRODUCTO -->
  <dialog class="modal" id="modalProduct" aria-label="Producto">
    <div class="modal-head">
      <div>
        <div class="modal-title" id="prodTitle">Nuevo producto</div>
        <div class="muted small">Barcode ‚Üí nombre ‚Üí precios ‚Üí categor√≠a</div>
      </div>
      <button class="icon-btn" data-close="modalProduct" aria-label="Cerrar">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="field-row">
        <label class="field">
          <span>Barcode</span>
          <input id="prodBarcode" inputmode="numeric" placeholder="Escanear o escribir‚Ä¶" />
        </label>
        <label class="field">
          <span>Nombre</span>
          <input id="prodName" placeholder="Ej: Pl√°tano canario‚Ä¶" />
        </label>
      </div>

      <div class="field-row">
        <label class="field">
          <span>PVP (IVA incl.)</span>
          <input id="prodPrice" inputmode="decimal" placeholder="0,00" />
        </label>
        <label class="field">
          <span>Compra (opcional)</span>
          <input id="prodCost" inputmode="decimal" placeholder="0,00" />
        </label>
        <label class="field">
          <span>Categor√≠a</span>
          <select id="prodCat"></select>
        </label>
      </div>

      <div class="field-row">
        <label class="field">
          <span>Favorito</span>
          <select id="prodFav">
            <option value="0">No</option>
            <option value="1">S√≠</option>
          </select>
        </label>
        <label class="field">
          <span>Unidad</span>
          <select id="prodUnit">
            <option value="ud">Ud</option>
            <option value="kg">Kg</option>
          </select>
        </label>
      </div>
    </div>

    <div class="modal-foot">
      <button class="btn btn-ghost" data-close="modalProduct" type="button">Cancelar</button>
      <button class="btn btn-primary" id="btnProductSave" type="button">Guardar</button>
    </div>
  </dialog>

  <!-- EMAIL TICKET -->
  <dialog class="modal" id="modalEmail" aria-label="Enviar ticket">
    <div class="modal-head">
      <div>
        <div class="modal-title">Enviar ticket</div>
        <div class="muted small">mailto (sin servidor)</div>
      </div>
      <button class="icon-btn" data-close="modalEmail" aria-label="Cerrar">‚úï</button>
    </div>

    <div class="modal-body">
      <label class="field">
        <span>Email</span>
        <input id="emailTo" type="email" placeholder="cliente@email.com" />
      </label>
      <label class="field">
        <span>Mensaje (opcional)</span>
        <textarea id="emailMsg" rows="4" placeholder="Mensaje extra‚Ä¶"></textarea>
      </label>
    </div>

    <div class="modal-foot">
      <button class="btn btn-ghost" data-close="modalEmail" type="button">Cancelar</button>
      <button class="btn btn-primary" id="btnEmailSend" type="button">Abrir email</button>
    </div>
  </dialog>

  <!-- CIERRE Z -->
  <dialog class="modal" id="modalCloseZ" aria-label="Cierre Z">
    <div class="modal-head">
      <div>
        <div class="modal-title">Cierre Z</div>
        <div class="muted small">Arqueo (efectivo contado) + descuadre</div>
      </div>
      <button class="icon-btn" data-close="modalCloseZ" aria-label="Cerrar">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="closez-grid">
        <div class="card-mini">
          <div class="muted small">Total ventas</div>
          <div class="mono big" id="zTotal">0,00 ‚Ç¨</div>
        </div>
        <div class="card-mini">
          <div class="muted small">Efectivo esperado</div>
          <div class="mono big" id="zCash">0,00 ‚Ç¨</div>
        </div>
        <div class="card-mini">
          <div class="muted small">Tarjeta</div>
          <div class="mono big" id="zCard">0,00 ‚Ç¨</div>
        </div>
      </div>

      <div class="field-row">
        <label class="field">
          <span>Efectivo contado</span>
          <input id="zCounted" inputmode="decimal" placeholder="0,00" />
        </label>
        <label class="field">
          <span>Descuadre</span>
          <input id="zDiff" disabled placeholder="0,00" />
        </label>
      </div>

      <label class="field">
        <span>Nota (opcional)</span>
        <input id="zNote" placeholder="Ej: cambio inicial, incidencia‚Ä¶" />
      </label>
    </div>

    <div class="modal-foot">
      <button class="btn btn-ghost" data-close="modalCloseZ" type="button">Cancelar</button>
      <button class="btn btn-primary" id="btnCloseZOk" type="button">Guardar Cierre Z</button>
    </div>
  </dialog>

  <!-- FILE INPUTS (hidden) -->
  <input id="fileJson" type="file" accept="application/json" hidden />
  <input id="fileCsv" type="file" accept=".csv,text/csv" hidden />

  <script src="./app.js?v=1.2" defer></script>
</body>
</html>
